-- Tạo database
CREATE DATABASE IF NOT EXISTS thegioididong CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE thegioididong;

-- Bảng sản phẩm
CREATE TABLE IF NOT EXISTS products (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    brand VARCHAR(100) NOT NULL,
    price INT NOT NULL,
    oldPrice INT,
    discount INT DEFAULT 0,
    image TEXT,
    category VARCHAR(50) DEFAULT 'phone',
    ram INT,
    storage INT,
    rating INT DEFAULT 5,
    hot BOOLEAN DEFAULT FALSE,
    bestSelling BOOLEAN DEFAULT FALSE,
    stock INT DEFAULT 10,
    specs JSON,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng người dùng
CREATE TABLE IF NOT EXISTS users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    address TEXT,
    birthday DATE,
    role ENUM('user', 'admin') DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng đơn hàng
CREATE TABLE IF NOT EXISTS orders (
    id INT PRIMARY KEY AUTO_INCREMENT,
    user_id INT,
    order_number VARCHAR(50) UNIQUE NOT NULL,
    customer_name VARCHAR(255) NOT NULL,
    customer_phone VARCHAR(20) NOT NULL,
    customer_email VARCHAR(255),
    address TEXT NOT NULL,
    items JSON NOT NULL,
    subtotal INT NOT NULL,
    shipping_fee INT DEFAULT 0,
    discount INT DEFAULT 0,
    total INT NOT NULL,
    payment_method VARCHAR(50),
    payment_method_name VARCHAR(100),
    status ENUM('Chờ xác nhận', 'Đã xác nhận', 'Đang giao', 'Hoàn thành', 'Đã hủy') DEFAULT 'Chờ xác nhận',
    note TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng đánh giá
CREATE TABLE IF NOT EXISTS reviews (
    id INT PRIMARY KEY AUTO_INCREMENT,
    product_id INT NOT NULL,
    user_id INT,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255),
    rating INT NOT NULL CHECK (rating >= 1 AND rating <= 5),
    content TEXT NOT NULL,
    status ENUM('pending', 'approved', 'rejected') DEFAULT 'pending',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng phụ kiện
CREATE TABLE IF NOT EXISTS accessories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(255) NOT NULL,
    brand VARCHAR(100) NOT NULL,
    price INT NOT NULL,
    oldPrice INT,
    discount INT DEFAULT 0,
    image TEXT,
    category VARCHAR(50) DEFAULT 'accessory',
    type VARCHAR(50),
    compatible_with JSON,
    rating INT DEFAULT 5,
    stock INT DEFAULT 50,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng voucher
CREATE TABLE IF NOT EXISTS vouchers (
    id INT PRIMARY KEY AUTO_INCREMENT,
    code VARCHAR(50) UNIQUE NOT NULL,
    type ENUM('percent', 'fixed') DEFAULT 'percent',
    value INT NOT NULL,
    min_order INT DEFAULT 0,
    max_discount INT,
    quantity INT DEFAULT 100,
    used INT DEFAULT 0,
    expiry DATE,
    description TEXT,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng danh mục
CREATE TABLE IF NOT EXISTS categories (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    icon VARCHAR(50),
    description TEXT,
    display_order INT DEFAULT 0,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Bảng thương hiệu
CREATE TABLE IF NOT EXISTS brands (
    id INT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) UNIQUE NOT NULL,
    slug VARCHAR(100) UNIQUE NOT NULL,
    logo TEXT,
    description TEXT,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Thêm admin mặc định
INSERT INTO users (name, email, phone, password, role) VALUES
('Admin', 'admin@thegioididong.com', '0123456789', '123', 'admin');

-- Thêm danh mục mặc định
INSERT INTO categories (name, slug, icon, description, display_order) VALUES
('Điện thoại', 'phone', 'fa-mobile-alt', 'Điện thoại di động các loại', 1),
('Máy tính bảng', 'tablet', 'fa-tablet-alt', 'Máy tính bảng iPad, Samsung Tab', 2),
('Laptop', 'laptop', 'fa-laptop', 'Laptop văn phòng, gaming', 3),
('Phụ kiện', 'accessory', 'fa-headphones', 'Tai nghe, sạc, ốp lưng', 4),
('Đồng hồ thông minh', 'smartwatch', 'fa-clock', 'Smartwatch, vòng đeo tay', 5);

-- Thêm thương hiệu mặc định
INSERT INTO brands (name, slug, description) VALUES
('Apple', 'apple', 'Thương hiệu công nghệ hàng đầu thế giới'),
('Samsung', 'samsung', 'Tập đoàn điện tử Hàn Quốc'),
('Xiaomi', 'xiaomi', 'Thương hiệu công nghệ Trung Quốc'),
('OPPO', 'oppo', 'Thương hiệu điện thoại phổ biến'),
('Vivo', 'vivo', 'Thương hiệu điện thoại Trung Quốc'),
('Realme', 'realme', 'Thương hiệu điện thoại giá rẻ');

-- Thêm voucher mặc định
INSERT INTO vouchers (code, type, value, min_order, max_discount, quantity, expiry, description) VALUES
('SALE10', 'percent', 10, 0, 1000000, 100, '2025-12-31', 'Giảm 10% cho đơn hàng'),
('SALE20', 'percent', 20, 5000000, 2000000, 50, '2025-12-31', 'Giảm 20% cho đơn từ 5 triệu'),
('FREESHIP', 'fixed', 30000, 0, 30000, 200, '2025-12-31', 'Miễn phí vận chuyển');
